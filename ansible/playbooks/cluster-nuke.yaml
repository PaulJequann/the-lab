---
- hosts: all
  become: true
  become_user: root
  gather_facts: true
  any_errors_fatal: true
  vars_prompt:
    - name: nuke
      prompt: |-
        Are you sure you want to nuke this cluster?
        Type YES I WANT TO DESTROY THIS CLUSTER to proceed
      default: "n"
      private: false
  pre_tasks:
    - name: Check for confirmation
      ansible.builtin.fail:
        msg: Aborted nuking the cluster
      when: nuke != 'YES I WANT TO DESTROY THIS CLUSTER'

    - name: Pausing for 5 seconds...
      ansible.builtin.pause:
        seconds: 5
      
    - name: Set variables for uninstall
      set_fact:
        k3s_uninstall_reboot: true
        
  tasks:
    - name: Uninstall k3s
      ansible.builtin.include_role:
        name: k3s
        tasks_from: uninstall
